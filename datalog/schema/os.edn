;; Copyright Â© 2021 Atomist, Inc.
;;
;; Licensed under the Apache License, Version 2.0 (the "License");
;; you may not use this file except in compliance with the License.
;; You may obtain a copy of the License at
;;
;;     http://www.apache.org/licenses/LICENSE-2.0
;;
;; Unless required by applicable law or agreed to in writing, software
;; distributed under the License is distributed on an "AS IS" BASIS,
;; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
;; See the License for the specific language governing permissions and
;; limitations under the License.

{:attributes
 {;; package manager of a docker image
  :docker.image/package-manager                  {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/one}

  :os/package-manager                            {:db.entity/attrs [:schema/random-guid]}
  :os.package-manager/type                       {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/one}
  :os.package-manager/sources                    {:db/valueType   :db.type/string
                                                  :db/cardinality :db.cardinality/many}

  :os.package-manager.type/APK                   {}
  :os.package-manager.type/APT                   {}

  ;; os distro of a docker image
  :docker.image/distro                           {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/one}

  :os/distro                                     {:db.entity/attrs [:schema/random-guid]}
  :os.distro/name                                {:db/valueType   :db.type/string
                                                  :db/cardinality :db.cardinality/one}
  :os.distro/version                             {:db/valueType   :db.type/string
                                                  :db/cardinality :db.cardinality/one}
  :os.distro/os-id                               {:db/valueType   :db.type/string
                                                  :db/cardinality :db.cardinality/one}
  :os.distro/os-id-like                          {:db/valueType   :db.type/string
                                                  :db/cardinality :db.cardinality/many}

  ;; os packages installed
  :docker.image/packages                         {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/many}

  :docker.file.run/packages                      {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/many}

  :os/package                                    {:db.entity/attrs [:schema/random-guid]}
  :os.package/name                               {:db/valueType   :db.type/string
                                                  :db/cardinality :db.cardinality/one}
  :os.package/installed-version                  {:db/valueType   :db.type/string
                                                  :db/cardinality :db.cardinality/one}
  :os.package/latest-version                     {:db/valueType   :db.type/string
                                                  :db/cardinality :db.cardinality/one}


  ;; Docker vulnerability analysis always pointing at the most current reference image and analysis
  :analysis/default-discovery                    {:db.entity/attrs [:analysis.default-discovery/type
                                                                    :analysis.default-discovery/repository]}
  :analysis.default-discovery/type               {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/one}
  :analysis.default-discovery/discovery          {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/one}
  :analysis.default-discovery/previous-discovery {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/one}
  :analysis.default-discovery/repository         {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/one}
  :analysis.default-discovery/last-updated       {:db/valueType   :db.type/instant
                                                  :db/cardinality :db.cardinality/one}

  :analysis.default-discovery.type/HEAD          {}


  ;; vulnerability status on :docker/image
  :vulnerability/report                          {:db.entity/attrs [:vulnerability.report/image]}
  :vulnerability.report/image                    {:db/valueType   :db.type/ref
                                                  :db/cardinality :db.cardinality/one}
  :vulnerability.report/last-updated             {:db/valueType   :db.type/instant
                                                  :db/cardinality :db.cardinality/one}
  :vulnerability.report/critical                 {:db/valueType   :db.type/long
                                                  :db/cardinality :db.cardinality/one}
  :vulnerability.report/high                     {:db/valueType   :db.type/long
                                                  :db/cardinality :db.cardinality/one}
  :vulnerability.report/medium                   {:db/valueType   :db.type/long
                                                  :db/cardinality :db.cardinality/one}
  :vulnerability.report/low                      {:db/valueType   :db.type/long
                                                  :db/cardinality :db.cardinality/one}
  :vulnerability.report/minimal                  {:db/valueType   :db.type/long
                                                  :db/cardinality :db.cardinality/one}
  :vulnerability.report/unspecified              {:db/valueType   :db.type/long
                                                  :db/cardinality :db.cardinality/one}

  }
 }
